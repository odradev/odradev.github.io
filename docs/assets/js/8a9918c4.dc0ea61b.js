"use strict";(self.webpackChunkodra_website=self.webpackChunkodra_website||[]).push([[2139],{3905:(n,e,t)=>{t.d(e,{Zo:()=>u,kt:()=>m});var a=t(67294);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function o(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function c(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?o(Object(t),!0).forEach((function(e){r(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function i(n,e){if(null==n)return{};var t,a,r=function(n,e){if(null==n)return{};var t,a,r={},o=Object.keys(n);for(a=0;a<o.length;a++)t=o[a],e.indexOf(t)>=0||(r[t]=n[t]);return r}(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(a=0;a<o.length;a++)t=o[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}var l=a.createContext({}),s=function(n){var e=a.useContext(l),t=e;return n&&(t="function"==typeof n?n(e):c(c({},e),n)),t},u=function(n){var e=s(n.components);return a.createElement(l.Provider,{value:e},n.children)},d={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},p=a.forwardRef((function(n,e){var t=n.components,r=n.mdxType,o=n.originalType,l=n.parentName,u=i(n,["components","mdxType","originalType","parentName"]),p=s(t),m=r,f=p["".concat(l,".").concat(m)]||p[m]||d[m]||o;return t?a.createElement(f,c(c({ref:e},u),{},{components:t})):a.createElement(f,c({ref:e},u))}));function m(n,e){var t=arguments,r=e&&e.mdxType;if("string"==typeof n||r){var o=t.length,c=new Array(o);c[0]=p;var i={};for(var l in e)hasOwnProperty.call(e,l)&&(i[l]=e[l]);i.originalType=n,i.mdxType="string"==typeof n?n:r,c[1]=i;for(var s=2;s<o;s++)c[s]=t[s];return a.createElement.apply(null,c)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},6725:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>s});var a=t(87462),r=(t(67294),t(3905));const o={},c="Wasm-Client",i={unversionedId:"advanced/wasm-client",id:"advanced/wasm-client",title:"Wasm-Client",description:"To unlock the full potential of Odra contracts, you can leverage the Wasm client to interact with your deployed contracts",source:"@site/docs/advanced/10-wasm-client.md",sourceDirName:"advanced",slug:"/advanced/wasm-client",permalink:"/docs/next/advanced/wasm-client",draft:!1,tags:[],version:"current",lastUpdatedAt:1771419602,formattedLastUpdatedAt:"Feb 18, 2026",sidebarPosition:10,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Factory",permalink:"/docs/next/advanced/factory"},next:{title:"Backends",permalink:"/docs/next/category/backends"}},l={},s=[{value:"Project Structure",id:"project-structure",level:2},{value:"Contract",id:"contract",level:2},{value:"Setup",id:"setup",level:2},{value:"Odra Wasm Client",id:"odra-wasm-client",level:2},{value:"Interacting with the Contract",id:"interacting-with-the-contract",level:2},{value:"Conclusion",id:"conclusion",level:2}],u={toc:s};function d(n){let{components:e,...t}=n;return(0,r.kt)("wrapper",(0,a.Z)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"wasm-client"},"Wasm-Client"),(0,r.kt)("p",null,"To unlock the full potential of Odra contracts, you can leverage the Wasm client to interact with your deployed contracts\nin a TypeScript environment. The Odra Wasm client library provides a seamless way to connect to the Casper blockchain."),(0,r.kt)("h2",{id:"project-structure"},"Project Structure"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-plaintext"},"counter\n|\u2500\u2500 cli\n\u2502    \u251c\u2500\u2500 bin\n\u2502    |   \u251c\u2500\u2500 build_contract.rs\n\u2502    |   \u2514\u2500\u2500 build_schema.rs\n\u2502    \u251c\u2500\u2500 src\n\u2502    \u2502   \u2514\u2500\u2500 lib.rs\n\u2502    |\u2500\u2500 build.rs\n\u2502    \u2514\u2500\u2500 Cargo.toml\n|\u2500\u2500 counter\n\u2502    \u251c\u2500\u2500 src\n\u2502    \u2502   \u251c\u2500\u2500 access\n\u2502    \u2502   \u2502   \u251c\u2500\u2500 access_control.rs\n\u2502    \u2502   \u2502   \u251c\u2500\u2500 events.rs\n\u2502    \u2502   \u2502   \u2514\u2500\u2500 errors.rs\n\u2502    \u2502   \u2514\u2500\u2500 lib.rs\n\u2502    |\u2500\u2500 build.rs\n\u2502    |\u2500\u2500 Cargo.toml\n\u2502    \u2514\u2500\u2500 Odra.toml\n|\u2500\u2500 counter_client\n\u2502    \u2514\u2500\u2500 pkg-web\n\u2502        \u251c\u2500\u2500 counter_wasm_client.wasm\n\u2502        \u251c\u2500\u2500 counter_wasm_client.wasm.d.ts\n\u2502        \u251c\u2500\u2500 counter_wasm_client.d.ts\n\u2502        \u251c\u2500\u2500 counter_wasm_client.js\n\u2502        \u2514\u2500\u2500 package.json\n|\u2500\u2500 resources\n\u2502   \u2514\u2500\u2500 casper_contract_schemas\n\u2502       \u2514\u2500\u2500 counter_schema.json\n\u2502\u2500\u2500 Cargo.toml\n\u2502\u2500\u2500 Odra.toml\n\u2514\u2500\u2500 rust-toolchain\n    \n")),(0,r.kt)("h2",{id:"contract"},"Contract"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"use odra::prelude::*;\n\n#[odra::module(\n    events = [CounterIncremented, CounterDecremented, CounterSet],\n    errors = Error\n)]\npub struct Counter {\n    value: Var<u32>,\n}\n\n#[odra::module]\nimpl Counter {\n    pub fn init(&mut self, initial_value: u32) {\n        self.value.set(initial_value);\n    }\n\n    pub fn increment(&mut self) {\n        let current_value = self.value.get_or_default();\n        if current_value < u32::MAX {\n            let new_value = current_value + 1;\n            self.value.set(new_value);\n            self.env().emit_event(CounterIncremented { new_value });\n        } else {\n            self.env().revert(Error::Overflow);\n        }\n    }\n\n    pub fn decrement(&mut self) {\n        let current_value = self.value.get_or_default();\n        if current_value > 0 {\n            let new_value = current_value - 1;\n            self.value.set(new_value);\n            self.env().emit_event(CounterDecremented { new_value });\n        } else {\n            self.env().revert(Error::Underflow);\n        }\n    }\n\n    pub fn set(&mut self, new_value: u32) {\n        self.value.set(new_value);\n        self.env().emit_event(CounterSet { new_value });\n    }\n\n    pub fn read(&self) -> u32 {\n        self.value.get_or_default()\n    }\n}\n\n#[odra::odra_error]\npub enum Error {\n    Overflow = 1,\n    Underflow = 2,\n}\n\n#[odra::event]\npub struct CounterIncremented {\n    new_value: u32,\n}\n\n#[odra::event]\npub struct CounterDecremented {\n    new_value: u32,\n}\n\n#[odra::event]\npub struct CounterSet {\n    new_value: u32,\n}\n")),(0,r.kt)("h2",{id:"setup"},"Setup"),(0,r.kt)("p",null,"To generate the Wasm client for your Odra project, execute the following command in your terminal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"cargo odra generate-client\n")),(0,r.kt)("p",null,"This command generates the Wasm client for the ",(0,r.kt)("inlineCode",{parentName:"p"},"Counter")," contract, creating the necessary TypeScript files in the ",(0,r.kt)("inlineCode",{parentName:"p"},"counter_client/pkg-web")," directory."),(0,r.kt)("p",null,"Once the client is generated, you can use it in your TypeScript project as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'import init, {\n    AccountInfo,\n    Contracts,\n    CounterWasmClient,\n    CsprClickCallbacks,\n    OdraWasmClient,\n    TransactionStatus,\n    TransactionResult,\n} from "counter-wasm-client";\n\nconst RPC_URL = "...";\nconst SPECULATIVE_RPC_URL = "...";\nconst CHAIN_NAME = "casper-test";\n\n// ---------- Types ----------\nlet counter: CounterWasmClient;\nlet client: OdraWasmClient;\nlet contracts: Contracts;\n\nasync function onConnect(accountInfo: AccountInfo) {\n  // Handle successful connection\n}\n\nfunction onTransactionStatusUpdate(status: TransactionStatus, data: TransactionResult) {\n  if (status === TransactionStatus.SENT) {\n    // Transaction has been sent\n  } else if (status === TransactionStatus.PROCESSED) {\n    if (data.error) {\n      if (data.errorCode) {\n        if (data.errorCode === CounterErrors.Overflow) {\n          // Specific error handling for Overflow\n        } else if (data.errorCode === CounterErrors.Underflow) {\n          // Specific error handling for Underflow\n        } else {\n          // Handle other specific errors\n        }\n      } else {\n        // Handle generic error without specific code\n      }\n    } else {\n      // Transaction succeeded\n    }\n  } else if (status === TransactionStatus.ERROR) {\n    // Handle unknown error\n  }\n}\n\nasync function run() {\n    // 1. Initialize WASM\n    await init();\n\n    // 2. Initialize the clients\n    contracts = await Contracts.fromPath(\'./contracts.json\');\n    client = new OdraWasmClient(RPC_URL, SPECULATIVE_RPC_URL, CHAIN_NAME);\n    counter = new CounterWasmClient(client, contracts.get("Counter").address);\n\n    // 3. Set your custom callback\n    CsprClickCallbacks.onSignedIn(async (accountInfo: AccountInfo) => {\n        console.log(\'Signed in handler:\');\n        await onConnect(accountInfo);\n    });\n    CsprClickCallbacks.onSwitchedAccount(async (accountInfo: AccountInfo) => {\n        console.log(\'Switched account handler:\', accountInfo);\n        await onConnect(accountInfo);\n    });\n    CsprClickCallbacks.onSignedOut(() => {\n        console.log(\'Signed out handler\');\n        // Reset state\n    });\n    CsprClickCallbacks.onTransactionStatusUpdate((status: TransactionStatus, data: TransactionResult) => {\n        console.log(\'Transaction status update handler:\', status, data);\n        onTransactionStatusUpdate(status, data);\n    });\n}\n\n// 4. Start the initialization process\nrun().catch(err => console.error("Failed to initialize:", err));\n')),(0,r.kt)("p",null,"There a few key steps to note in the above code:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"WASM Initialization"),": The ",(0,r.kt)("inlineCode",{parentName:"li"},"init()")," function is called to initialize the WASM module."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Client Setup"),": An instance of ",(0,r.kt)("inlineCode",{parentName:"li"},"OdraWasmClient")," is created to connect to the Casper blockchain, and a ",(0,r.kt)("inlineCode",{parentName:"li"},"CounterWasmClient")," is instantiated to interact with the ",(0,r.kt)("inlineCode",{parentName:"li"},"Counter")," contract."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Cspr.Click Callbacks"),": Custom callbacks are set up to handle events such as signing in, switching accounts, signing out, and transaction status updates.")),(0,r.kt)("p",null,"We will take a closer look at these components in the sections below."),(0,r.kt)("h2",{id:"odra-wasm-client"},"Odra Wasm Client"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"OdraWasmClient")," is a key component of the Odra Wasm client library that facilitates interaction with contracts deployed on the Casper blockchain\nand seamslessly integrates with CsprClick."),(0,r.kt)("p",null,"It abstracts away the complexities of interacting with the blockchain, allowing you to focus on building your application logic. You don't need to worry\nabout low-level details such as constructing transactions or handling signatures; the ",(0,r.kt)("inlineCode",{parentName:"p"},"OdraWasmClient")," takes care of these aspects for you."),(0,r.kt)("p",null,"Additionally, it provides built-in support for basic operations such as signing transactions, and querying account information,\nconnecting/disconnecting wallets making it easier to work with Odra contracts in a TypeScript environment."),(0,r.kt)("h2",{id:"interacting-with-the-contract"},"Interacting with the Contract"),(0,r.kt)("p",null,"An instance of ",(0,r.kt)("inlineCode",{parentName:"p"},"OdraWasmClient")," is used to create a contract-specific client, in this case, ",(0,r.kt)("inlineCode",{parentName:"p"},"CounterWasmClient"),",\nwhich provides methods to interact with the ",(0,r.kt)("inlineCode",{parentName:"p"},"Counter")," contract."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'import {\n    setGas,\n    DEFAULT_PAYMENT_AMOUNT,\n} from "counter-wasm-client";\n\nasync function increment() {\n  try {\n    setGas(DEFAULT_PAYMENT_AMOUNT());\n    await counter.increment();\n  } catch (e: any) {\n    // Handle specific contract errors\n  }\n}\n\nasync function decrement() {\n  try {\n    setGas(DEFAULT_PAYMENT_AMOUNT());\n    await counter.decrement();\n  } catch (e: any) {\n    // Handle specific contract errors\n  }\n}\n\nasync function set_value(value: number) {\n  try {\n    setGas(DEFAULT_PAYMENT_AMOUNT());\n    await counter.set_value(value);\n  } catch (e: any) {\n    // Handle specific contract errors\n  }\n}\n\nasync function read_value() {\n  try {\n    const value = await counter.read();\n    // Use the retrieved value\n  } catch (e: any) {\n    // Handle specific contract errors\n  }\n}\n')),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"By utilizing the Odra Wasm client, you can interact with your Odra contracts in a TypeScript environment with\nminimal effort. The ",(0,r.kt)("inlineCode",{parentName:"p"},"OdraWasmClient")," simplifies the process of connecting to the Casper blockchain.\nDon't bother with low-level details; focus on building your dapp logic and let the client handle the complexities\nof blockchain interaction."))}d.isMDXComponent=!0}}]);